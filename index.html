<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Top Heroes Rush Event Calculator</title>
  <style>
    body {
      background-color: #1a172b;
      color: #ffd449;
      font-family: 'Arial Rounded MT Bold', sans-serif;
      text-align: center;
    }
    h1 {
      font-size: 2.5rem;
      margin-top: 1rem;
    }
    table {
      margin: 1rem auto;
      border-collapse: collapse;
      width: 80%;
      background-color: #2a2740;
      color: #fff;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 1rem;
      font-size: 1.2rem;
    }
    th {
      background-color: #38355c;
    }
    input[type=number] {
      width: 60px;
    }
    .btn {
      background-color: #64ff64;
      border: none;
      padding: 0.75rem 1.5rem;
      margin: 1rem;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 10px;
    }
    .progress {
      background-color: #333;
      border-radius: 10px;
      width: 80%;
      margin: 1rem auto;
      height: 30px;
    }
    .bar {
      background-color: #64ff64;
      height: 100%;
      border-radius: 10px 0 0 10px;
    }
    #rankingTable {
      margin-top: 2rem;
      width: 60%;
    }
  </style>
</head>
<body>
  <h1>üèÜ Top Heroes Rush Event Calculator üèÜ</h1>

  <table>
    <thead>
      <tr>
        <th>Resource</th>
        <th>Pts/Unit</th>
        <th>What you have</th>
        <th>You'll get</th>
      </tr>
    </thead>
    <tbody id="resources">
      <tr>
        <td>üìñ Skill Books (x10)</td>
        <td>1</td>
        <td><input type="number" id="skill" value="0" onchange="updateScore()"></td>
        <td id="score_skill">0</td>
      </tr>
      <tr>
        <td>üçº Pet Food (x100)</td>
        <td>15</td>
        <td><input type="number" id="pet" value="0" onchange="updateScore()"></td>
        <td id="score_pet">0</td>
      </tr>
      <tr>
        <td>ü™ô Use Uncommon Pet</td>
        <td>150</td>
        <td><input type="number" id="unco" value="0" onchange="updateScore()"></td>
        <td id="score_unco">0</td>
      </tr>
      <tr>
        <td>ü™ö Use Rare Pet</td>
        <td>900</td>
        <td><input type="number" id="rare" value="0" onchange="updateScore()"></td>
        <td id="score_rare">0</td>
      </tr>
    </tbody>
  </table>

  <h2>Total Points: <span id="total">0</span> / 40000</h2>
  <div class="progress">
    <div class="bar" id="progressBar" style="width: 0%"></div>
  </div>

  <form id="scoreForm" onsubmit="submitScore(event)">
    <input id="pseudo" placeholder="Pseudo" required><br>
    <button class="btn" type="submit">Envoyer mon score</button>
  </form>

  <h2>üèÜ Classement en direct</h2>
  <table id="rankingTable">
    <thead>
      <tr><th>Pseudo</th><th>Score</th></tr>
    </thead>
    <tbody id="ranking"></tbody>
  </table>

  <script>
    function updateScore() {
      const skill = Math.floor(parseInt(document.getElementById("skill").value || 0) / 10);
      const pet = Math.floor(parseInt(document.getElementById("pet").value || 0) / 100) * 15;
      const unco = parseInt(document.getElementById("unco").value || 0) * 150;
      const rare = parseInt(document.getElementById("rare").value || 0) * 900;
      const total = skill + pet + unco + rare;

      document.getElementById("score_skill").textContent = skill;
      document.getElementById("score_pet").textContent = pet;
      document.getElementById("score_unco").textContent = unco;
      document.getElementById("score_rare").textContent = rare;
      document.getElementById("total").textContent = total;
      document.getElementById("progressBar").style.width = (total / 40000 * 100) + "%";
    }

    async function loadRanking() {
      const res = await fetch("https://opensheet.elk.sh/1iCrVEcqdJfa6xssi5wcB6p6DVP6USv4hYaP8Wl5SQcQ/Ranking");
      const data = await res.json();

      if (!Array.isArray(data)) return;

      data.sort((a, b) => parseInt(b.Score) - parseInt(a.Score));
      const table = document.getElementById("ranking");
      table.innerHTML = "";
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.Pseudo}</td><td>${row.Score}</td>`;
        table.appendChild(tr);
      });
    }

    async function submitScore(e) {
      e.preventDefault();

      const pseudo = document.getElementById("pseudo").value.trim();
      const score = parseInt(document.getElementById("total").textContent);

      if (!pseudo) {
        alert("Merci de saisir un pseudo !");
        return;
      }

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbw7azMyPGpEFMNQQ2iHsgnsg3SomRzmva6_tAnfNX4-pwPmbXmP6owX5bIDCoBsASrVfQ/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ pseudo, score })
        });

        if (response.ok) {
          alert("‚úÖ Score envoy√© !");
          loadRanking();
        } else {
          alert("‚ùå Une erreur est survenue.");
        }
      } catch (err) {
        alert("‚ùå Erreur r√©seau.");
        console.error(err);
      }
    }

    updateScore();
    loadRanking();
    setInterval(loadRanking, 10000);
  </script>
</body>
</html>
