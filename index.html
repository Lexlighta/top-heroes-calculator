
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Top Heroes Rush Event - Multiplayer Full</title>
  <style>
    body {
      background-color: #0f0f2d;
      color: #ffd700;
      font-family: 'Trebuchet MS', sans-serif;
      text-align: center;
      padding: 20px;
    }
    table {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      border-collapse: collapse;
      background-color: #1d1d3b;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #444;
      color: #fff;
    }
    th {
      background-color: #2c2c50;
    }
    input[type="number"], input[type="text"] {
      padding: 5px;
      font-size: 1em;
      width: 80px;
      text-align: center;
    }
    #submitBtn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #00ff88;
      border: none;
      font-size: 1em;
      cursor: pointer;
      border-radius: 10px;
    }
    .progress-container {
      background-color: #333;
      border-radius: 8px;
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      overflow: hidden;
    }
    .progress-bar {
      height: 24px;
      background-color: #00ff88;
      width: 0%;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <h1>‚öîÔ∏è Top Heroes Rush Event Calculator ‚öîÔ∏è</h1>

  <p><strong>Pseudo :</strong></p>
  <input type="text" id="pseudo" placeholder="Your name" oninput="checkForm()" />

  <table>
    <thead>
      <tr>
        <th>Resource</th>
        <th>Pts/Unit</th>
        <th>What you have</th>
        <th>You'll get</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>üìò Skill Books (x10)</td>
        <td>1</td>
        <td><input type="number" id="qty-0" min="0" value="0" oninput="updateTotal()" /></td>
        <td id="res-0">0</td>
      </tr>
      <tr>
        <td>ü•£ Pet Food (x100)</td>
        <td>15</td>
        <td><input type="number" id="qty-1" min="0" value="0" oninput="updateTotal()" /></td>
        <td id="res-1">0</td>
      </tr>
      <tr>
        <td>üü¢ Use Uncommon Pet for EXP/Promo</td>
        <td>150</td>
        <td><input type="number" id="qty-2" min="0" value="0" oninput="updateTotal()" /></td>
        <td id="res-2">0</td>
      </tr>
      <tr>
        <td>üîµ Use Rare Pet for EXP/Promo</td>
        <td>900</td>
        <td><input type="number" id="qty-3" min="0" value="0" oninput="updateTotal()" /></td>
        <td id="res-3">0</td>
      </tr>
    </tbody>
  </table>

  <div>
    <h2>Total Points: <span id="totalPoints">0</span> / 40000</h2>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>

  <button id="submitBtn" onclick="submitScore()" disabled>Envoyer mon score</button>
  <p id="status"></p>

  <h2>üèÜ Classement en direct</h2>
  <table id="ranking">
    <thead>
      <tr><th>Pseudo</th><th>Score</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbx6wmtKI-UgyjgIZiMiTtc0t9yCr74874hHU4z6Csr-ZDRsth1KsiX8Lx0MndOhaQN3Hw/exec";
    let lastScoreSent = -1;

    function updateTotal() {
      let total = 0;
      const qty0 = parseInt(document.getElementById("qty-0").value) || 0;
      const qty1 = parseInt(document.getElementById("qty-1").value) || 0;
      const qty2 = parseInt(document.getElementById("qty-2").value) || 0;
      const qty3 = parseInt(document.getElementById("qty-3").value) || 0;

      const pts0 = Math.floor(qty0 / 10);
      const pts1 = Math.floor(qty1 / 100) * 15;
      const pts2 = qty2 * 150;
      const pts3 = qty3 * 900;

      total = pts0 + pts1 + pts2 + pts3;

      document.getElementById("res-0").textContent = pts0;
      document.getElementById("res-1").textContent = pts1;
      document.getElementById("res-2").textContent = pts2;
      document.getElementById("res-3").textContent = pts3;

      document.getElementById("totalPoints").textContent = total;
      document.getElementById("progressBar").style.width = Math.min(100, total / 40000 * 100) + "%";

      checkForm();
    }

    function checkForm() {
      const pseudo = document.getElementById("pseudo").value.trim();
      const score = parseInt(document.getElementById("totalPoints").textContent);
      document.getElementById("submitBtn").disabled = !pseudo || score === lastScoreSent;
    }

    async function submitScore() {
      const pseudo = document.getElementById("pseudo").value.trim();
      const score = parseInt(document.getElementById("totalPoints").textContent);
      if (!pseudo || isNaN(score)) return;

      lastScoreSent = score;
      document.getElementById("submitBtn").disabled = true;
      document.getElementById("status").textContent = "‚è≥ Envoi en cours...";

      await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({ pseudo, score }),
        headers: { "Content-Type": "application/json" }
      });

      document.getElementById("status").textContent = "‚úÖ Score envoy√© !";
      loadRanking();
    }

    async function loadRanking() {
      const sheetURL = "https://opensheet.elk.sh/1iCrVEcqdJfa6xssi5wcB6p6DVP6USv4hYaP8Wl5SQcQ/Ranking";
      const res = await fetch(sheetURL);
      const data = await res.json();
      const tbody = document.querySelector("#ranking tbody");
      tbody.innerHTML = "";

      data.sort((a, b) => parseInt(b.Score) - parseInt(a.Score));
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.Pseudo}</td><td>${row.Score}</td>`;
        tbody.appendChild(tr);
      });
    }

    updateTotal();
    loadRanking();
  </script>
</body>
</html>
